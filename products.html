<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eyelix - Carbon Negative Eyewear | Sustainable & Stylish Glasses</title>
    <meta name="description" content="Discover Eyelix, the pioneer in carbon negative eyewear. Shop stylish & sustainable sunglasses and frames designed for the planet.">
    
    <!-- Font Awesome for star icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Link CSS files -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/footer.css">
    <link rel="stylesheet" href="css/products.css">

    <style>
        /* Star rating styles */
        .product-rating {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .star {
            display: flex;
            gap: 2px;
        }

        .star i {
            color: #ffc107;
            font-size: 14px;
        }

        .star i.far {
            color: #ddd;
        }

        .rating-count {
            font-size: 12px;
            color: #687279;
        }

        /* Color variations styles */
        .product-variations {
            display: flex;
            gap: 8px;
            margin-top: 0.75rem;
            flex-wrap: wrap;
        }

        .color-option {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 0px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .color-option:hover {
            transform: scale(1.1);
            border-color: #d2d2d2;
        }

        .color-option.active {
            border-color: #e5e5e5;
            box-shadow: 0 0 0 2px #fff, 0 0 0 2px #333;
        }

        /* Specific colors */
        .color-black { background-color: #000; }
        .color-tortoise { background: linear-gradient(135deg, #8B4513 0%, #D2691E 50%, #654321 100%); }
        .color-gold { background-color: #ffd900; }
        .color-rose { background-color: #E8C4C4; }
        .color-gray { background-color: #808080; }
        .color-brown { background-color: #8B4513; }
        .color-crystal { 
            background: linear-gradient(135deg, rgba(255,255,255,0.5) 0%, rgba(230,230,230,0.8) 100%);
            border: 2px solid #ddd;
        }
    </style>
</head>
<body>
    <!--  HEADER - Inject từ js/header.js -->
    <header id="header"></header>

    <!-- MAIN CONTENT -->
    <div class="container">
        <div class="page-title">
            <h1>Glasses Collection</h1>
            <p>Discover our sustainable and stylish eyewear collection</p>
        </div>

        <div class="filter-section">
            <div class="filters">
                <button class="filter-btn active" data-filter="all">All Products</button>
                <button class="filter-btn" data-filter="bestseller">Bestsellers</button>
                <button class="filter-btn" data-filter="new">New In</button>
                <button class="filter-btn" data-filter="sale">Sale</button>
            </div>
            <select class="sort-dropdown" id="sortBy">
                <option value="featured">Featured</option>
                <option value="price-low">Price: Low to High</option>
                <option value="price-high">Price: High to Low</option>
                <option value="newest">Newest</option>
            </select>
        </div>

        <div class="products-grid" id="productsGrid">
            <!-- Products will be loaded by JavaScript -->
        </div>
    </div>

   <!-- FOOTER - Inject từ js/footer.js -->
    <footer id="footer"></footer>

    <!-- Products Page JS -->
    <script>
        // Sample Product Data with rating and variations
        const products = [
            {
                id: 4182,
                title: 'Oris',
                category: 'Glasses',
                price: 660000,
                originalPrice: null,
                image: "images/products/oris.png",
                badge: 'new',
                sold: 7,
                rating: 5,
                reviewCount: 12,
                filter: ['all', 'bestseller', 'new'],
                variations: [
                    { color: 'black', image: 'images/products/oris.png' },
                    { color: 'tortoise', image: 'images/products/oris-tortoise.png' },
                    { color: 'gold', image: 'images/products/oris-gold.png' },
                    { color: 'rose', image: 'images/products/oris-rose.png' }
                ]
            },
            {
                id: 4176,
                title: 'Jules',
                category: 'Glasses',
                price: 760000,
                originalPrice: null,
                image: "images/products/jules.png",
                badge: null,
                sold: 1,
                rating: 4.5,
                reviewCount: 8,
                filter: ['all', 'bestseller'],
                variations: [
                    { color: 'black', image: 'images/products/jules.png' },
                    { color: 'brown', image: 'images/products/jules-brown.png' }
                ]
            },
            {
                id: 4210,
                title: 'Maison',
                category: 'Sunglasses',
                price: 777000,
                originalPrice: null,
                image: "images/products/maison.png",
                badge: 'new',
                sold: 1,
                rating: 5,
                reviewCount: 3,
                filter: ['all', 'new'],
                variations: [
                    { color: 'black', image: 'images/products/maison.png' },
                    { color: 'gray', image: 'images/products/maison-gray.png' }
                ]
            },
            {
                id: 4202,
                title: 'Nuit',
                category: 'Sunglasses',
                price: 790000,
                originalPrice: null,
                image: "images/products/nuit.png",
                badge: null,
                sold: 5,
                rating: 4,
                reviewCount: 15,
                filter: ['all', 'bestseller'],
                variations: [
                    { color: 'brown', image: 'images/products/nuit-brown.png' },
                    { color: 'crystal', image: 'images/products/nuit-crystal.png' }
                ]
            },
            {
                id: 4194,
                title: 'Dada',
                category: 'Sunglasses',
                price: 780000,
                originalPrice: 800000,
                image: "images/products/dada.png",
                badge: 'sale',
                sold: 2,
                rating: 4.5,
                reviewCount: 6,
                filter: ['all', 'sale'],
                variations: [
                    { color: 'black', image: 'images/products/dada.png' },
                    { color: 'tortoise', image: 'images/products/dada-tortoise.png' }
                ]
            },
            {
                id: 4185,
                title: 'Aloe',
                category: 'Sunglasses',
                price: 650000,
                originalPrice: null,
                image: "images/products/aloe.png",
                badge: null,
                sold: 3,
                rating: 5,
                reviewCount: 10,
                filter: ['all'],
                variations: [
                    { color: 'black', image: 'images/products/aloe.png' },
                    { color: 'gold', image: 'images/products/aloe-gold.png' },
                    { color: 'rose', image: 'images/products/aloe-rose.png' }
                ]
            }
        ];

        let currentFilter = 'all';
        let currentSort = 'featured';
        let cart = JSON.parse(localStorage.getItem('cart')) || [];

        function formatPrice(price) {
            return price.toLocaleString('vi-VN') + ' VND';
        }

        // Function to generate star rating HTML
        function generateStarRating(rating, reviewCount) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 !== 0;
            const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);

            let starsHTML = '<div class="star">';
            
            // Full stars
            for (let i = 0; i < fullStars; i++) {
                starsHTML += '<i class="fas fa-star"></i>';
            }
            
            // Half star
            if (hasHalfStar) {
                starsHTML += '<i class="fas fa-star-half-alt"></i>';
            }
            
            // Empty stars
            for (let i = 0; i < emptyStars; i++) {
                starsHTML += '<i class="far fa-star"></i>';
            }
            
            starsHTML += '</div>';
            
            return `
                <div class="product-rating">
                    ${starsHTML}
                    <span class="rating-count">(${reviewCount})</span>
                </div>
            `;
        }

        // Function to generate color variations HTML
        function generateColorVariations(productId, variations) {
            if (!variations || variations.length === 0) return '';
            
            let variationsHTML = '<div class="product-variations">';
            
            variations.forEach((variation, index) => {
                const activeClass = index === 0 ? 'active' : '';
                variationsHTML += `
                    <div class="color-option color-${variation.color} ${activeClass}" 
                         onclick="changeProductImage(${productId}, '${variation.image}', this)"
                         title="${variation.color}">
                    </div>
                `;
            });
            
            variationsHTML += '</div>';
            return variationsHTML;
        }

        // Function to change product image when color is clicked
        function changeProductImage(productId, newImage, clickedElement) {
            // Find the product card
            const productCard = clickedElement.closest('.product-item');
            const productImage = productCard.querySelector('.product-image img');
            
            // Update image with smooth transition
            productImage.style.opacity = '0.5';
            setTimeout(() => {
                productImage.src = newImage;
                productImage.style.opacity = '1';
            }, 150);
            
            // Update active state
            const allColorOptions = productCard.querySelectorAll('.color-option');
            allColorOptions.forEach(option => option.classList.remove('active'));
            clickedElement.classList.add('active');
        }

        function renderProducts() {
            const filtered = products.filter(p => p.filter.includes(currentFilter));
            
            let sorted = [...filtered];
            if (currentSort === 'price-low') {
                sorted.sort((a, b) => a.price - b.price);
            } else if (currentSort === 'price-high') {
                sorted.sort((a, b) => b.price - a.price);
            } else if (currentSort === 'newest') {
                sorted.reverse();
            }

            const grid = document.getElementById('productsGrid');
            grid.innerHTML = '';

            sorted.forEach(product => {
                const productHTML = `
                    <div class="product-item">
                        <div class="product-image">
                            <img src="${product.image}" alt="${product.title}" style="transition: opacity 0.3s ease;">
                            ${product.badge ? `<div class="product-badge ${product.badge}">${product.badge === 'sale' ? 'Sale' : 'New'}</div>` : ''}
                        </div>
                        <div class="product-info">
                            <div class="product-category">${product.category}</div>
                            <div class="product-title">${product.title}</div>
                            ${generateColorVariations(product.id, product.variations)}
                            ${generateStarRating(product.rating, product.reviewCount)}
                            <div class="product-price ${product.badge === 'sale' ? 'sale' : ''}">
                                ${product.originalPrice ? `<span class="original">${formatPrice(product.originalPrice)}</span>` : ''}
                                ${formatPrice(product.price)}
                            </div>
                            <div class="product-actions">
                                <button class="btn-add-cart" onclick="addToCart(${product.id}, '${product.title}', ${product.price})">
                                    Add to cart
                                </button>
                                <button class="btn-wishlist" onclick="toggleWishlist(this)">♡</button>
                            </div>
                            <div style="font-size: 12px; color: #687279; margin-top: 0.5rem;">
                                ${product.sold} sold
                            </div>
                        </div>
                    </div>
                `;
                grid.innerHTML += productHTML;
            });
        }

        // Filter handling
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                currentFilter = e.target.dataset.filter;
                renderProducts();
            });
        });

        // Sort handling
        document.getElementById('sortBy').addEventListener('change', (e) => {
            currentSort = e.target.value;
            renderProducts();
        });

        // Add to cart
        function addToCart(id, title, price) {
            cart.push({ id, title, price });
            localStorage.setItem('cart', JSON.stringify(cart));
            localStorage.setItem('cartCount', cart.length);
            
            // Update cart count in header
            if (window.updateCartCount) {
                window.updateCartCount();
            }
            
            alert(`${title} added to cart!`);
        }

        // Wishlist toggle
        function toggleWishlist(btn) {
            btn.textContent = btn.textContent === '♡' ? '♥' : '♡';
            btn.style.color = btn.textContent === '♥' ? '#e00d0d' : 'inherit';
        }

        // Initial render
        renderProducts();
    </script>

    <!--JavaScript Files (Header & Footer must be loaded FIRST) -->
    <script src="js/header.js"></script>
    <script src="js/footer.js"></script>
    <script src="js/main.js"></script>
    <script src="js/products.js"></script>
</body>
</html>